<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">

<polymer-element name="common-nav">
  <template>
    <style>
      :host {
        display: block;
        position: relative;
      }
      [section-client] {
        height: 100%;
      }
    </style>
    <div section-client>
      <content></content>
    </div>
    <div fit fade hidden?="{{!loading}}" vertical layout center-center>
      <paper-spinner active></paper-spinner>
    </div>
  </template>
  <script>
    Polymer({
      eventDelegates: {
        'common-nav common-nav-push common-nav-pop': 'navAction',
      },
      created: function () {
        this._navAction = this.element.getEventHandler(this, this, 'navAction');
        this.stack = [];
      },
      navAction: function (e, detail) {
        e.stopPropagation();
        if (e.type == 'common-nav-push') {
          detail.type = 'push';
        } else if (e.type == 'common-nav-pop') {
          detail.type = 'pop';
        }
        this.goto(detail);
      },
      goto: function (args) {
        var arr = args.imports;
        var self = this;

        function load() {
          self.loading = false;
          var el = typeof args.element == 'string' ?
            document.createElement(args.element) :
            args.element;
          el.navArgs = args;
          if (args.stacked) {
            self.appendChild(el);
          } else {
            while (self.lastChild)
              self.removeChild(self.lastChild);
            self.appendChild(el);
          }
        }
        if (arr) {
          if (!Array.isArray(arr)) arr = [arr];
          this.loading = true;
          Polymer.import(arr, load);
        } else {
          load();
        }
      }
    });
  </script>
</polymer-element>