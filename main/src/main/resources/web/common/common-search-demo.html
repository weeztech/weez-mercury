<!DOCTYPE html>
<html>

<head>
  <title></title>
  <script src="../bower_components/webcomponentsjs/webcomponents.min.js"></script>
  <link rel="import" href="../bower_components/polymer/polymer.html">
  <link rel="stylesheet" href="../index.css">
</head>

<body unresolved fullbleed>
  <core-selector class="list">
    <div>Item 0</div>
    <div>Item 1</div>
    <div>Item 2</div>
    <div>Item 3</div>
    <div>Item 4</div>
  </core-selector>
  <link rel="import" href="../common/common-search.html">
  <link rel="import" href="../bower_components/core-selector/core-selector.html">

  <template is="auto-binding">
    <input type="checkbox" checked="{{multi}}">multiple selection mode
    <common-search-selector style="height: 300px" selection="{{$.selection}}" on-query="{{queryAction}}">
      <template>
        <style>
          .item {
            cursor: pointer;
          }
          .item[selected] {
            background: red;
          }
        </style>
        <div class="item" selected?="{{selected}}">{{value.num}} {{value.text}}</div>
      </template>
    </common-search-selector>
    <common-selection id="selection" keyprop="num" selected="{{selected}}" multi?="{{multi}}"></common-selection>
    <p>
      following are selected:
    </p>
    <template if="{{multi}}" repeat="{{selected}}">
      <span>{{num}} {{text}}</span>
    </template>
    <template if="{{!multi}}">
      <span>{{selected.num}} {{selected.text}}</span>
    </template>
  </template>

  <script>
    var namegen = {
      generateString: function (inLength) {
        var s = '';
        for (var i = 0; i < inLength; i++) {
          s += String.fromCharCode(Math.floor(Math.random() * 26) + 97);
        }
        return s;
      },
      generateName: function (inMin, inMax) {
        return this.generateString(Math.floor(Math.random() * (inMax - inMin + 1) + inMin));
      }
    };

    window.addEventListener('template-bound', function (e) {
      var data = [];
      for (var i = 0; i < 30; i++) {
        data.push({
          text: namegen.generateName(3, 6)
        });
      }
      data.sort(function (a, b) {
        if (a.text > b.text) return 1;
        if (a.text < b.text) return -1;
        return 0;
      });
      data.forEach(function (i, k) {
        i.num = k;
      });
      var tpl = e.target;
      tpl.queryAction = function (e, detail) {
        console.log('query with keywords: %s', detail.keywords);
        window.setTimeout(function () {
          var arr = data;
          if (detail.keywords) {
            arr = arr.filter(function (i) {
              return i.text.indexOf(detail.keywords) >= 0;
            });
          }
          var end = detail.start + 10;
          var hasMore = end < arr.length;
          arr = arr.slice(detail.start, end);
          console.log('data from %d to %d', detail.start, end);
          detail.load({
            items: arr,
            hasMore: hasMore
          });
        }, 1000);
      };
    });
  </script>
</body>

</html>